# Документація GitHub Actions

## Автоматизована збірка та розгортання релізів

### release-deploy.yml

Цей workflow автоматизує весь процес релізу, включаючи:

1. Збірку Docker образу для Next.js додатку (uniia-landing)
2. Публікацію образу в GitHub Container Registry (ghcr.io)
3. Оновлення Fleet конфігурації для автоматичного розгортання

#### Тригери

Workflow запускається при створенні нового релізу в GitHub (подія "release" з типом "published").

#### Структура workflow

Workflow складається з двох послідовних job:

1. **build-and-push**: Збірка та публікація Docker образу

   - Визначає тип релізу (RC або стабільний)
   - Додає відповідні теги до образу (`latest` для стабільних, `latest-rc` для RC)
   - Публікує образ в GitHub Container Registry

2. **update-fleet-config**: Оновлення Fleet конфігурації для розгортання (запускається після успішного завершення першого job)
   - Створює нову гілку з оновленнями
   - Оновлює конфігураційні файли Fleet для відповідного середовища
   - Створює Pull Request з оновленнями

#### Умови визначення середовища розгортання

Релізи автоматично розгортаються в різні середовища в залежності від типу:

1. **Тестове середовище** (`web-landing-test`):

   - Реліз позначено як "pre-release" в GitHub
   - АБО тег релізу містить суфікс "-rc" (наприклад, "v1.0.0-rc.1")
   - Використовується тег образу `latest-rc`

2. **Продакшн-середовище** (`web-landing-prod`):
   - Стабільний реліз (без позначки "pre-release")
   - Тег релізу не містить суфікс "-rc"
   - Використовується тег образу `latest`

#### Необхідні права

Workflow потребує наступних дозволів:

- `contents: read/write` - для читання вмісту репозиторію та створення гілок
- `packages: write` - для публікації Docker образу в ghcr.io
- `pull-requests: write` - для створення Pull Request з оновленнями конфігурації

#### Налаштування

1. Створіть новий реліз в GitHub з відповідним тегом (наприклад, "v1.0.0")
2. Виберіть опцію "This is a pre-release" для тестових релізів або додайте суфікс "-rc" до тегу
3. GitHub Actions автоматично виконає всі необхідні дії
4. Перевірте та вручну злийте створений Pull Request для оновлення Fleet конфігурації

#### Доступ до образів

Опубліковані образи доступні за адресою:

```
ghcr.io/[username-or-organization]/uniia-landing:[tag]
```

Де:

- `[username-or-organization]` - ім'я користувача або організації в GitHub
- `[tag]` - тег релізу (наприклад, "v1.0.0", "latest" або "latest-rc")
