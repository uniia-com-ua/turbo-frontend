# Fleet конфігурація для uniia-landing

Ця директорія містить конфігурацію для автоматичного розгортання додатку uniia-landing за допомогою Rancher Fleet.

## Структура директорій

```
fleet/
├── fleet.yaml                # Головний конфігураційний файл для Fleet
├── resources/                # Базові Kubernetes ресурси
│   ├── deployment.yaml       # Базовий деплоймент
│   ├── service.yaml          # Сервіс
│   ├── ingress.yaml          # Ingress
│   └── kustomization.yaml    # Kustomize конфігурація для базових ресурсів
├── production/               # Конфігурація для продакшн-середовища
│   ├── kustomization.yaml    # Kustomize конфігурація для продакшн
│   └── patch-deployment.yaml # Патч для продакшн деплойменту
└── test/                     # Конфігурація для тестового середовища
    ├── kustomization.yaml    # Kustomize конфігурація для тестового середовища
    ├── patch-deployment.yaml # Патч для тестового деплойменту
    └── patch-ingress.yaml    # Патч для інгресу тестового середовища
```

## Розгортання

Ця конфігурація інтегрується з GitHub Actions workflow `release-deploy.yml` і автоматично розгортає:

1. Версії з позначкою `-rc` або pre-release в тестове середовище (`web-landing-test`):

   - Використовується домен `test.app.uniia.io`
   - Використовується тег образу `latest-rc`
   - Менша кількість реплік (1) та обмежені ресурси

2. Стабільні версії в продакшн-середовище (`web-landing-prod`):
   - Використовується домен `app.uniia.io`
   - Використовується тег образу `latest`
   - Більша кількість реплік (3) та більше виділених ресурсів

## Процес автоматичного релізу

1. При створенні релізу в GitHub автоматично запускається workflow `release-deploy.yml`:

   - Збирає та публікує Docker образ з відповідними тегами
   - Визначає тип релізу та цільове середовище
   - Створює Pull Request з оновленням Fleet конфігурації

2. Після злиття Pull Request, Fleet автоматично:
   - Виявляє зміни в конфігурації
   - Розгортає нову версію додатку у відповідному середовищі

## Налаштування в Rancher

1. Зареєструйте цей Git-репозиторій в Rancher Fleet:

   - Відкрийте Rancher Dashboard -> Continuous Delivery -> Git Repos
   - Натисніть "Add Repository"
   - Введіть ім'я репозиторію та URL
   - Вкажіть шлях до директорії Fleet: `apps/landing/fleet`

2. Створіть необхідні namespace в кластері:
   - `web-landing-prod`
   - `web-landing-test`

## Особливості роботи

- Fleet автоматично слідкує за змінами в конфігурації в Git-репозиторії
- Кожен реліз автоматично розгортається у відповідне середовище
- При необхідності можна вручну керувати процесом злиття PR з оновленнями Fleet конфігурації
