# Fleet конфігурація для uniia-landing

Ця директорія містить конфігурацію для автоматичного розгортання додатку uniia-landing за допомогою Rancher Fleet.

## Структура директорій

```
fleet/
├── production/                     # Конфігурація для продакшн-середовища
│   ├── fleet.yaml                  # Fleet конфігурація для продакшн-середовища
│   ├── deployment.yaml             # Деплоймент для продакшн
│   ├── service.yaml                # Сервіс для продакшн
│   ├── ingress.yaml                # Інгрес для продакшн
│   └── kustomization.yaml          # Kustomize конфігурація для продакшн
└── test/                           # Конфігурація для тестового середовища
    ├── fleet.yaml                  # Fleet конфігурація для тестового середовища
    ├── deployment.yaml             # Деплоймент для тесту
    ├── service.yaml                # Сервіс для тесту
    ├── ingress.yaml                # Інгрес для тесту
    └── kustomization.yaml          # Kustomize конфігурація для тестового середовища
```

## Розгортання

Ця конфігурація інтегрується з GitHub Actions workflow `release-deploy.yml` і автоматично розгортає:

1. Версії з позначкою `-rc` або pre-release в тестове середовище (`web-landing-test`):

   - Використовується домен `test.uniia.com.ua`
   - Використовується тег образу `latest-rc`
   - Менша кількість реплік (1) та обмежені ресурси

2. Стабільні версії в продакшн-середовище (`web-landing-prod`):
   - Використовується домен `app.uniia.io`
   - Використовується тег образу `latest`
   - Більша кількість реплік (3) та більше виділених ресурсів

## Процес автоматичного релізу

1. При створенні релізу в GitHub автоматично запускається workflow `release-deploy.yml`:

   - Збирає та публікує Docker образ з відповідними тегами
   - Визначає тип релізу та цільове середовище
   - Створює Pull Request з оновленням Fleet конфігурації

2. Після злиття Pull Request, Fleet автоматично:
   - Виявляє зміни в конфігурації
   - Розгортає нову версію додатку у відповідному середовищі

## Налаштування в Rancher

1. Зареєструйте Git-репозиторій в Rancher Fleet для кожного середовища:

   - Відкрийте Rancher Dashboard -> Continuous Delivery -> Git Repos
   - Натисніть "Add Repository"
   - Для продакшн-середовища:
     - Ім'я: `uniia-landing-production`
     - URL: `https://github.com/uniia-com-ua/turbo-frontend`
     - Шлях: `apps/landing/fleet/production`
   - Для тестового середовища:
     - Ім'я: `uniia-landing-test`
     - URL: `https://github.com/uniia-com-ua/turbo-frontend`
     - Шлях: `apps/landing/fleet/test`

2. Створіть необхідні namespace в кластері:
   - `web-landing-prod`
   - `web-landing-test`

## Особливості роботи

- Кожне середовище є повністю самодостатнім, з власними ресурсами та конфігурацією
- Кожне середовище має власну Fleet конфігурацію, що дозволяє незалежне розгортання
- Fleet автоматично слідкує за змінами в конфігурації в Git-репозиторії
- Кожен реліз автоматично розгортається у відповідне середовище
- При необхідності можна вручну керувати процесом злиття PR з оновленнями Fleet конфігурації
